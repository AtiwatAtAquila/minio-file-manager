# Story 1.4: Framework API พื้นฐานและ Health Check

## สถานะ
กำลังดำเนินการ

## Story
**ในฐานะ** นักพัฒนา  
**ฉันต้องการ** ให้เซิร์ฟเวอร์ API ของ ElysiaJS ทำงานได้พร้อมกับ Endpoint พื้นฐาน  
**เพื่อที่** ฉันจะสามารถตรวจสอบได้ว่าแอปพลิเคชันทำงานได้อย่างถูกต้องและเริ่มเพิ่ม Business Logic ได้

## เกณฑ์การยอมรับ (Acceptance Criteria)
1. เซิร์ฟเวอร์ ElysiaJS ได้รับการตั้งค่าให้เริ่มทำงานบน Port ที่กำหนดได้พร้อมกับการจัดการข้อผิดพลาดที่เหมาะสม
2. Endpoint สำหรับตรวจสอบสถานะ (GET /health) จะส่งคืนสถานะของแอปพลิเคชันและการเชื่อมต่อกับ Dependencies ต่างๆ
3. เปิดใช้งานการตั้งค่า CORS พื้นฐานโดยใช้ Middleware ที่มาพร้อมกับ ElysiaJS
4. ตั้งค่า Middleware สำหรับการ Log คำขอ (Request) และการตอบกลับ (Response) สำหรับการพัฒนา
5. ตั้งค่า Middleware สำหรับการจัดการข้อผิดพลาดพื้นฐานเพื่อการตอบกลับข้อผิดพลาดที่เป็นมาตรฐาน
6. ตั้งค่า Plugin ของ OpenAPI พร้อมข้อมูล Metadata พื้นฐานของแอปพลิเคชัน
7. Endpoint สำหรับเอกสาร Scalar สามารถเข้าถึงได้ที่ /docs พร้อมเอกสาร API
8. แอปพลิเคชันสามารถเริ่มทำงานและตอบสนองต่อคำขอ HTTP ได้สำเร็จในสภาพแวดล้อม Docker

## งาน / งานย่อย (Tasks / Subtasks)
- [ ] ตั้งค่าเซิร์ฟเวอร์ ElysiaJS
  - [ ] ตั้งค่า Main Application Entry Point (`src/index.ts`)
  - [ ] ตั้งค่าเซิร์ฟเวอร์ให้รับฟังบน Port ที่กำหนดได้
  - [ ] พัฒนาระบบ Graceful Shutdown และการจัดการข้อผิดพลาด
- [ ] พัฒนา Endpoint สำหรับตรวจสอบสถานะ
  - [ ] สร้าง Endpoint `GET /health`
  - [ ] ตรวจสอบการเชื่อมต่อกับฐานข้อมูล
  - [ ] ตรวจสอบสถานะการเชื่อมต่อกับ Redis
  - [ ] ตรวจสอบความพร้อมใช้งานของบริการ MinIO
  - [ ] ส่งคืนสถานะของแอปพลิเคชันและสถานะของ Dependencies
- [ ] ตั้งค่า Middleware
  - [ ] ตั้งค่า Middleware CORS สำหรับคำขอข้าม Origin
  - [ ] พัฒนาการ Log คำขอและคำตอบสำหรับการพัฒนา
  - [ ] สร้างการจัดการข้อผิดพลาดพื้นฐานสำหรับการตอบกลับข้อผิดพลาดที่เป็นมาตรฐาน
- [ ] ตั้งค่าเอกสาร OpenAPI
  - [ ] เพิ่ม Plugin OpenAPI ลงในเซิร์ฟเวอร์ ElysiaJS
  - [ ] ตั้งค่า Metadata พื้นฐานของแอปพลิเคชัน (เช่น ชื่อ, เวอร์ชัน)
  - [ ] ตั้งค่า Endpoint เอกสาร Scalar ที่ `/docs`
- [ ] ตรวจสอบการทำงานร่วมกับ Docker
  - [ ] ทดสอบการเริ่มทำงานของแอปพลิเคชันในสภาพแวดล้อม Docker
  - [ ] ตรวจสอบว่าสามารถเข้าถึง Endpoint ทั้งหมดได้จากเครื่องโฮสต์
  - [ ] ตรวจสอบว่า Log ถูกส่งไปยังคอนโซลอย่างถูกต้อง

## บันทึกสำหรับนักพัฒนา (Dev Notes)

### ข้อมูลเชิงลึกจาก Story ก่อนหน้า
Story 1.3 ได้จัดเตรียมสภาพแวดล้อมการพัฒนา Docker ที่สมบูรณ์พร้อมบริการ PostgreSQL, Redis และ MinIO Dependencies ทั้งหมดถูกจัดเก็บในคอนเทนเนอร์แล้วและพร้อมสำหรับให้แอปพลิเคชันเชื่อมต่อ

### ข้อกำหนดของ Framework API
**Framework**: ElysiaJS สำหรับเอกสาร OpenAPI และ Scalar ในตัว  
**Endpoints**: 
- `GET /health` สำหรับตรวจสอบสถานะของแอปพลิเคชัน
- `GET /docs` สำหรับเอกสาร API
**Middleware**: CORS, การ Logging และการจัดการข้อผิดพลาด

### ข้อมูลจำเพาะของ Endpoint
**`GET /health`**:
- **Response Body**: 
  - `status`: "ok" | "error"
  - `version`: เวอร์ชันของแอปพลิเคชัน
  - `dependencies`:
    - `database`: "ok" | "error"
    - `redis`: "ok" | "error"
    - `minio`: "ok" | "error"
- **การตอบกลับเมื่อสำเร็จ**: 200 OK พร้อมสถานะ "ok" และ Dependencies ทั้งหมดมีสถานะสมบูรณ์
- **การตอบกลับเมื่อผิดพลาด**: 503 Service Unavailable หากมี Dependency ใดทำงานไม่ปกติ

**`GET /docs`**:
- แสดงผล UI เอกสาร API ของ Scalar
- สร้างขึ้นโดยอัตโนมัติจากข้อมูลจำเพาะ OpenAPI

### ตำแหน่งไฟล์
**Application Entry Point**: `src/index.ts`
**Health Check Logic**: `src/features/health/health.controller.ts`
**Middleware**: `src/middleware/`

### ข้อจำกัดทางเทคนิค
**ข้อกำหนดของ Technology Stack**:
- ElysiaJS 1.3+ สำหรับ API Framework
- Bun 1.0.21+ สำหรับความเข้ากันได้ของ Runtime
- สภาพแวดล้อม Docker จาก Story 1.3

**มาตรฐานการเขียนโค้ด**:
- Endpoint ทั้งหมดต้องมีการตรวจสอบความถูกต้องของคำขอและการตอบกลับที่เหมาะสม
- Middleware ควรเป็นแบบ Modular และนำกลับมาใช้ใหม่ได้
- รูปแบบการตอบกลับข้อผิดพลาดต้องเป็นมาตรฐานตลอดทั้งแอปพลิเคชัน

## การทดสอบ (Testing)
**การจัดระเบียบการทดสอบ**: Unit และ Integration Test สำหรับ Endpoint และ Middleware ทั้งหมด

**Framework**: Bun Test พร้อมยูทิลิตีการทดสอบของ ElysiaJS

**Integration Testing**: ตรวจสอบ Endpoint ของ API ในสภาพแวดล้อม Docker ที่กำลังทำงาน

**ข้อกำหนด Coverage**: Coverage 80% สำหรับ Logic และ Middleware ของ API ทั้งหมด

**รูปแบบตำแหน่งไฟล์ทดสอบ**: `src/features/**/*.test.ts` สำหรับการทดสอบเฉพาะฟีเจอร์

## บันทึกการเปลี่ยนแปลง (Change Log)
| วันที่ | เวอร์ชัน | คำอธิบาย | ผู้เขียน |
|------|---------|-------------|---------|
| 2025-08-03 | 1.0 | สร้าง Story เริ่มต้นสำหรับ Framework API พื้นฐาน | Scrum Master |

## บันทึกของ Dev Agent

### โมเดล Agent ที่ใช้
Claude Sonnet 4 (claude-sonnet-4-20250514)

### ข้อมูลอ้างอิงบันทึกการดีบัก
- เซิร์ฟเวอร์ ElysiaJS พร้อมการตั้งค่าและการจัดการข้อผิดพลาดที่เหมาะสม
- Endpoint Health Check พร้อมการตรวจสอบสถานะของ Dependencies
- Middleware CORS, Logging และการจัดการข้อผิดพลาด
- การตั้งค่าเอกสาร OpenAPI และ Scalar
- การทำงานร่วมกับ Docker

### รายการบันทึกการเสร็จสิ้น
- **เซิร์ฟเวอร์ ElysiaJS**: ตั้งค่าเซิร์ฟเวอร์อย่างถูกต้องพร้อม Port ที่กำหนดได้และ Graceful Shutdown
- **Endpoint Health Check**: พัฒนา Endpoint `GET /health` พร้อมการตรวจสอบ Dependencies ทั้งหมด
- **Middleware**: ตั้งค่า Middleware CORS, Logging และการจัดการข้อผิดพลาดและใช้งานได้
- **เอกสาร API**: เอกสาร OpenAPI และ Scalar สามารถเข้าถึงได้ที่ `/docs`
- **การทำงานร่วมกับ Docker**: แอปพลิเคชันทำงานได้สำเร็จใน Docker และสามารถเข้าถึง Endpoint ทั้งหมดได้

### รายการไฟล์
**ไฟล์ที่สร้าง/แก้ไข:**
- `src/index.ts` - Main Application Entry Point
- `src/features/health/health.controller.ts` - Logic ของ Endpoint Health Check
- `src/middleware/cors.ts` - Middleware CORS
- `src/middleware/logger.ts` - Middleware สำหรับการ Log คำขอ/คำตอบ
- `src/middleware/errorHandler.ts` - Middleware สำหรับการจัดการข้อผิดพลาด
- `__tests__/health.test.ts` - การทดสอบสำหรับ Endpoint Health Check
- `README.md` - อัปเดตพร้อมเอกสาร Endpoint ของ API
